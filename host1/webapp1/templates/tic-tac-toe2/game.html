{% load static %} {% comment %} ğŸ‘ˆã‚ã¨ã§ static "URL" ã‚’ä½¿ã†ã®ã§ load static ã—ã¾ã™ {% endcomment %}
<!DOCTYPE html>
<html>
    <head>
        <link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}" />
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" />
        <title>Tic Tac Toe</title>
    </head>
    <body>
        <div id="app">
            <v-app>
                <v-main>
                    <v-container>
                        <h1>TIC TAC TOE</h1>
                        <h3>Welcome to room_{{room_name}}</h3>
                    </v-container>

                    <form name="form1" method="POST">
                        {% csrf_token %}
                        <v-container>
                            <v-row justify="center" dense>
                                <v-col>
                                    {% comment %} Vue ã§äºŒé‡æ³¢æ‹¬å¼§ï¼ˆbracesï¼‰ã¯å¤‰æ•°ã®å±•é–‹ã«ä½¿ã£ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€ Python ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«äºŒé‡æ³¢æ‹¬å¼§ã‚’å¤‰æ•°ã®å±•é–‹ã«ä½¿ã‚ãªã„ã‚ˆã† verbatim ã§æŒ‡ç¤ºã—ã¾ã™ã€‚ {% endcomment %} {% verbatim %}
                                    <v-btn id="square0" v-on:click="clickSquare(0)">{{label0}}</v-btn>
                                    <v-btn id="square1" v-on:click="clickSquare(1)">{{label1}}</v-btn>
                                    <v-btn id="square2" v-on:click="clickSquare(2)">{{label2}}</v-btn>
                                    {% endverbatim %}
                                </v-col>
                            </v-row>
                            <v-row justify="center" dense>
                                <v-col>
                                    {% verbatim %}
                                    <v-btn id="square3" v-on:click="clickSquare(3)">{{label3}}</v-btn>
                                    <v-btn id="square4" v-on:click="clickSquare(4)">{{label4}}</v-btn>
                                    <v-btn id="square5" v-on:click="clickSquare(5)">{{label5}}</v-btn>
                                    {% endverbatim %}
                                </v-col>
                            </v-row>
                            <v-row justify="center" dense>
                                <v-col>
                                    {% verbatim %}
                                    <v-btn id="square6" v-on:click="clickSquare(6)">{{label6}}</v-btn>
                                    <v-btn id="square7" v-on:click="clickSquare(7)">{{label7}}</v-btn>
                                    <v-btn id="square8" v-on:click="clickSquare(8)">{{label8}}</v-btn>
                                    {% endverbatim %}
                                </v-col>
                            </v-row>
                        </v-container>
                        <input type="hidden" name="room_name" value="{{room_name}}" />
                        <input type="hidden" name="my_piece" value="{{my_piece}}" />
                    </form>
                    <v-container>
                        <v-alert type="success" id="alert_your_move">Your turn. Place your move <strong>{{my_piece}}</strong></v-alert>
                    </v-container>
                    <v-container>
                        <v-btn block elevation="2" v-on:click="clickNewGame()" :disabled="isDisabledNewGameButton()"> New Game </v-btn>
                    </v-container>
                </v-main>
            </v-app>
        </div>

        <script src="{% static 'tic-tac-toe2/connection.js' %}"></script>
        <script src="{% static 'tic-tac-toe2/engine.js' %}"></script>
        <script src="{% static 'tic-tac-toe2/game.js' %}"></script>
        <script src="{% static 'tic-tac-toe2/protocol_main.js' %}"></script>
        <script src="{% static 'tic-tac-toe2/protocol_messages.js' %}"></script>

        <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
        <script>
            let vue1 = new Vue({
                el: "#app",
                vuetify: new Vuetify(),
                data: {
                    engine: new Engine(createSetMessageFromServer()),
                    state: "OnGoing",
                    label0: "",
                    label1: "",
                    label2: "",
                    label3: "",
                    label4: "",
                    label5: "",
                    label6: "",
                    label7: "",
                    label8: "",
                },
                // page loaded
                mounted: () => {
                    // ã“ã“ã§ Vue ã®æº–å‚™å®Œäº†å¾Œã®å‡¦ç†ãŒã§ãã‚‹ã€‚
                    // ãŸã ã—ã€ã¾ã  this ã¯åˆæœŸåŒ–ã•ã‚Œã¦ãªã„
                },
                methods: {
                    // ç”»é¢ã‚’åˆæœŸåŒ–
                    init() {
                        // console.log("[Debug] Vue#init()");
                        this.setState("OnGoing");

                        this.engine.game.init(this.engine.connection.myPiece);

                        // è‡ªåˆ†ã®æ‰‹ç•ªãªã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å¸¸æ™‚è¡¨ç¤º
                        this.refreshVisibilityOfAlertYourMove();

                        // ãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«ã‚’ã‚¯ãƒªã‚¢ãƒ¼
                        for (let sq = 0; sq < BOARD_AREA; sq += 1) {
                            this.setLabelOfButton(sq, PC_EMPTY_LABEL);
                        }
                    },
                    /**
                     * å‡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ã
                     * @param {*} sq - Square; 0 <= sq
                     */
                    clickSquare(sq) {
                        // console.log(`[Debug] Vue#clickSquare sq=${sq}`);
                        if (this.engine.game.board[sq] == PC_EMPTY) {
                            if (!this.engine.game.isMyTurn) {
                                alert("Wait for other to place the move");
                            } else {
                                this.engine.game.isMyTurn = false;

                                // è‡ªåˆ†ã®æ‰‹ç•ªãªã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å¸¸æ™‚è¡¨ç¤º
                                this.refreshVisibilityOfAlertYourMove();

                                this.engine.game.makeMove(parseInt(sq), this.engine.connection.myPiece);
                            }
                        }
                    },
                    /**
                     * è‡ªåˆ†ã®æ‰‹ç•ªãªã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å¸¸æ™‚è¡¨ç¤º
                     */
                    refreshVisibilityOfAlertYourMove() {
                        // console.log(`[Debug] Vue#refreshVisibilityOfAlertYourMove() isMyTurn=${this.engine.game.isMyTurn}`);
                        if (this.engine.game.isMyTurn) {
                            // document.getElementById("alert_your_move").style.display = "block";
                            document.getElementById("alert_your_move").style.visibility = "visible";
                        } else {
                            // Hide
                            // document.getElementById("alert_your_move").style.display = "none";
                            document.getElementById("alert_your_move").style.visibility = "hidden";
                        }
                    },
                    /**
                     * å‡ãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«å¤‰æ›´
                     * @param {number} sq - Square; 0 <= sq
                     * @param {*} piece - text
                     */
                    setLabelOfButton(sq, piece) {
                        // alert(`[Debug] Vue#setLabelOfButton sq=${sq} piece=${piece}`);
                        switch (sq) {
                            case 0:
                                this.label0 = piece;
                                break;
                            case 1:
                                this.label1 = piece;
                                break;
                            case 2:
                                this.label2 = piece;
                                break;
                            case 3:
                                this.label3 = piece;
                                break;
                            case 4:
                                this.label4 = piece;
                                break;
                            case 5:
                                this.label5 = piece;
                                break;
                            case 6:
                                this.label6 = piece;
                                break;
                            case 7:
                                this.label7 = piece;
                                break;
                            case 8:
                                this.label8 = piece;
                                break;
                            default:
                                alert(`[Error] sq=${sq}`);
                                break;
                        }
                    },
                    /**
                     *
                     */
                    clickNewGame() {
                        console.log(`New Game`);
                        this.init();
                    },
                    /**
                     *
                     */
                    setState(state) {
                        this.state = state;
                    },
                    /**
                     *
                     */
                    isDisabledNewGameButton() {
                        switch (this.state) {
                            case "EndOfGame":
                                return false; // Enable
                            default:
                                return true; // Disable
                        }
                    },
                },
            });
        </script>
    </body>
</html>
